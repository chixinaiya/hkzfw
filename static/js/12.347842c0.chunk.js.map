{"version":3,"sources":["../node_modules/antd-mobile/lib/nav-bar/style/css.js","../node_modules/antd-mobile/lib/nav-bar/index.js","pages/CityList/index.js"],"names":["require","Object","defineProperty","exports","value","_extends3","_interopRequireDefault","_classCallCheck3","_createClass3","_possibleConstructorReturn3","_inherits3","_classnames2","React","obj","__esModule","newObj","key","prototype","hasOwnProperty","call","_interopRequireWildcard","__rest","s","e","t","p","indexOf","getOwnPropertySymbols","i","length","NavBar","_React$Component","this","__proto__","getPrototypeOf","apply","arguments","_a","props","prefixCls","className","children","mode","icon","onLeftClick","leftContent","rightContent","restProps","createElement","role","onClick","Component","defaultProps","module","CityList","state","cityIndex","cityList","activeIndex","formatLetter","letter","isRight","toUpperCase","changCity","item","includes","label","setLocal","CURR_CITY","JSON","stringify","history","push","info","rowRenderer","index","style","isScrolling","isVisible","map","getCities","a","getCityList","status","data","formatCities","getHotCity","st","hot","unshift","getCurCity","res","setState","forEach","first","short","slice","keys","sort","excueHeight","renderCityIndex","listRef","scrollToRow","onRowsRendered","startIndex","console","log","type","goBack","height","width","ref","ele","scrollToAlignment","rowCount","rowHeight"],"mappings":"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","file":"static/js/12.347842c0.chunk.js","sourcesContent":["'use strict';\n\nrequire('../../style/css');\n\nrequire('./index.css');","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _react = require('react');\n\nvar React = _interopRequireWildcard(_react);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj['default'] = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar __rest = undefined && undefined.__rest || function (s, e) {\n    var t = {};\n    for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n    }if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n        if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n    }return t;\n};\n\nvar NavBar = function (_React$Component) {\n    (0, _inherits3['default'])(NavBar, _React$Component);\n\n    function NavBar() {\n        (0, _classCallCheck3['default'])(this, NavBar);\n        return (0, _possibleConstructorReturn3['default'])(this, (NavBar.__proto__ || Object.getPrototypeOf(NavBar)).apply(this, arguments));\n    }\n\n    (0, _createClass3['default'])(NavBar, [{\n        key: 'render',\n        value: function render() {\n            var _a = this.props,\n                prefixCls = _a.prefixCls,\n                className = _a.className,\n                children = _a.children,\n                mode = _a.mode,\n                icon = _a.icon,\n                onLeftClick = _a.onLeftClick,\n                leftContent = _a.leftContent,\n                rightContent = _a.rightContent,\n                restProps = __rest(_a, [\"prefixCls\", \"className\", \"children\", \"mode\", \"icon\", \"onLeftClick\", \"leftContent\", \"rightContent\"]);\n            return React.createElement(\n                'div',\n                (0, _extends3['default'])({}, restProps, { className: (0, _classnames2['default'])(className, prefixCls, prefixCls + '-' + mode) }),\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-left', role: 'button', onClick: onLeftClick },\n                    icon ?\n                    // tslint:disable-next-line:jsx-no-multiline-js\n                    React.createElement(\n                        'span',\n                        { className: prefixCls + '-left-icon', 'aria-hidden': 'true' },\n                        icon\n                    ) : null,\n                    leftContent\n                ),\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-title' },\n                    children\n                ),\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-right' },\n                    rightContent\n                )\n            );\n        }\n    }]);\n    return NavBar;\n}(React.Component);\n\nexports['default'] = NavBar;\n\nNavBar.defaultProps = {\n    prefixCls: 'am-navbar',\n    mode: 'dark',\n    onLeftClick: function onLeftClick() {}\n};\nmodule.exports = exports['default'];","import React, { Component } from \"react\";\r\nimport { getCityList, getHotCity } from \"../../utils/api/City\";\r\nimport { getCurCity, setLocal, CURR_CITY } from \"../../utils\";\r\nimport { List, AutoSizer } from \"react-virtualized\";\r\nimport \"./index.scss\";\r\nimport { NavBar, Icon, Toast } from \"antd-mobile\";\r\n\r\n// 假数据\r\n// const list = Array.from(new Array(100)).map((item, index) => {\r\n//   return { name: index };\r\n// });\r\n\r\nclass CityList extends Component {\r\n  // 设置状态数据\r\n  state = {\r\n    // 归类的城市数据的索引\r\n    cityIndex: [],\r\n    // 归类的城市数据\r\n    cityList: {},\r\n    // 当前滚动到的行索引\r\n    activeIndex: 0,\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.getCities();\r\n  }\r\n\r\n  // 格式化列表title\r\n  formatLetter = (letter, isRight) => {\r\n    switch (letter) {\r\n      case \"#\":\r\n        return isRight ? \"当\" : \"当前城市\";\r\n      case \"hot\":\r\n        return isRight ? \"热\" : \"热门城市\";\r\n\r\n      default:\r\n        // 处理成大写\r\n        return letter.toUpperCase();\r\n    }\r\n  };\r\n\r\n  // 切换城市\r\n  changCity = (item) => {\r\n    // 有数据\r\n    const hasData = [\"北京\", \"上海\", \"广州\", \"深圳\"];\r\n    if (hasData.includes(item.label)) {\r\n      // 更新当前城市数据\r\n      setLocal(CURR_CITY, JSON.stringify(item));\r\n      // 跳转到首页\r\n      this.props.history.push(\"/\");\r\n    } else {\r\n      Toast.info(\"该城市暂无房源数据\");\r\n    }\r\n  };\r\n\r\n  // 进行渲染方法\r\n  rowRenderer = ({\r\n    key, // Unique key within array of rows\r\n    index, // Index of row within collection\r\n    isScrolling, // The List is currently being scrolled\r\n    isVisible, // This row is visible within the List (eg it is not an overscanned row)\r\n    style, // Style object to be applied to row (to position it)\r\n  }) => {\r\n    // 获取处理完的状态数据\r\n    const { cityList, cityIndex } = this.state;\r\n    // 对象的键\r\n    let letter = cityIndex[index];\r\n    // console.log(index, letter);\r\n    // 对象的值\r\n    let item = cityList[letter];\r\n\r\n    return (\r\n      <div key={key} style={style} className=\"city-item\">\r\n        <div className=\"title\">{this.formatLetter(letter)}</div>\r\n        {item.map((item) => (\r\n          <div\r\n            onClick={() => {\r\n              this.changCity(item);\r\n            }}\r\n            key={item.value}\r\n            className=\"name\"\r\n          >\r\n            {item.label}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // 获取城市列表数据\r\n  getCities = async () => {\r\n    const { status, data } = await getCityList();\r\n    // console.log(status, data);\r\n    if (status === 200) {\r\n      let { cityList, cityIndex } = this.formatCities(data);\r\n\r\n      // 加入热门城市数据\r\n      const { status: st, data: hot } = await getHotCity();\r\n      if (st === 200) {\r\n        cityList[\"hot\"] = hot;\r\n        cityIndex.unshift(\"hot\");\r\n      }\r\n      // console.log(cityList, cityIndex);\r\n      // 加入当前城市\r\n      const res = await getCurCity();\r\n      // console.log(res);\r\n      cityList[\"#\"] = [res];\r\n      cityIndex.unshift(\"#\");\r\n      // console.log(cityList, cityIndex);\r\n      // 响应式\r\n      this.setState({\r\n        cityList,\r\n        cityIndex,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 按城市首字母归类城市数据\r\n  formatCities = (data) => {\r\n    // 归类的数据\r\n    let cityList = {},\r\n      cityIndex;\r\n    data.forEach((item) => {\r\n      // 获取当前城市首字母\r\n      let first = item.short.slice(0, 1);\r\n      // 排重和归类\r\n      // 判断存不存在当前首字母开头的键\r\n      if (!cityList[first]) {\r\n        // 不存在\r\n        cityList[first] = [item];\r\n      } else {\r\n        // 存在\r\n        cityList[first].push(item);\r\n      }\r\n    });\r\n    // console.log(cityList);\r\n    // 获取归类的首字母数据索引\r\n    cityIndex = Object.keys(cityList).sort();\r\n    // console.log(cityIndex);\r\n    // 遍历列表\r\n    // cityIndex.map((item) => {\r\n    //   console.log(item, cityList[item]);\r\n    // });\r\n    return {\r\n      cityList,\r\n      cityIndex,\r\n    };\r\n  };\r\n\r\n  // 动态计算高度\r\n  excueHeight = ({ index }) => {\r\n    const { cityList, cityIndex } = this.state;\r\n    // 计算公式：title高度36 + 当前归类城市数量 * 50\r\n    // 当前归类的城市数量\r\n\r\n    let curKey = cityIndex[index];\r\n    // console.log(curKey, cityList[curKey]);\r\n    return 36 + cityList[curKey].length * 50;\r\n  };\r\n\r\n  // 渲染右侧索引\r\n  renderCityIndex = () => {\r\n    const { cityIndex, activeIndex } = this.state;\r\n    return cityIndex.map((item, index) => {\r\n      return (\r\n        <li\r\n          key={item}\r\n          className=\"city-index-item\"\r\n          onClick={() => {\r\n            // 点击的时候定位列表\r\n            this.listRef.scrollToRow(index);\r\n            this.setState({\r\n              activeIndex: index,\r\n            });\r\n          }}\r\n        >\r\n          <span className={activeIndex === index ? \"index-active\" : \"\"}>\r\n            {this.formatLetter(item, true)}\r\n          </span>\r\n        </li>\r\n      );\r\n    });\r\n  };\r\n\r\n  // 每次渲染完都会执行\r\n  onRowsRendered = ({ startIndex }) => {\r\n    if (this.state.activeIndex !== startIndex) {\r\n      console.log(startIndex);\r\n      // startIndex当前滚动行的索引\r\n      this.setState({\r\n        activeIndex: startIndex,\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"cityList\">\r\n        <NavBar\r\n          mode=\"dark\"\r\n          icon={<Icon type=\"left\" />}\r\n          onLeftClick={() => this.props.history.goBack()}\r\n        >\r\n          地图找房\r\n        </NavBar>\r\n        {/* /城市列表 */}\r\n        <AutoSizer>\r\n          {({ height, width }) => (\r\n            <List\r\n              ref={(ele) => (this.listRef = ele)}\r\n              scrollToAlignment=\"start\"\r\n              onRowsRendered={this.onRowsRendered}\r\n              height={height}\r\n              rowCount={this.state.cityIndex.length}\r\n              rowHeight={this.excueHeight}\r\n              rowRenderer={this.rowRenderer}\r\n              width={width}\r\n            />\r\n          )}\r\n        </AutoSizer>\r\n        {/* 右侧索引列表 */}\r\n        <ul className=\"city-index\">{this.renderCityIndex()}</ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default CityList;\r\n"],"sourceRoot":""}